 # 权限矩阵与请求头约定

 本文梳理系统中的角色边界、API 能力与请求头透传约定，便于前后端与测试对齐。

 ## 角色与能力

 说明：课程相关能力均受“课程授权范围”限制；未授权课程的资源将返回权限不足。

 | 能力 | super_admin | course_admin | proofreader |
 |---|---|---|---|
 | 登录与基本信息 | ✅ | ✅ | ✅ |
 | 查看分类树/文档 | ✅ | ✅（限授权课程） | ✅ |
 | 创建分类（节点） | ✅ | ✅（限授权课程） | ❌ |
 | 编辑分类 | ✅ | ✅（限授权课程） | ❌ |
 | 删除/恢复/彻底删除分类 | ✅ | ✅（限授权课程） | ❌ |
 | 同级重排/跨父移动（reorder/reposition） | ✅ | ✅（限授权课程） | ❌ |
 | 创建/编辑/删除文档 | ✅ | ✅（限授权课程） | ❌ |
 | 文档回收站操作（恢复/彻底删除） | ✅ | ✅（限授权课程） | ❌ |
 | 文档引用关系（添加/删除/查询） | ✅ | ✅（限授权课程） | 只读（查询） |
 | 文档版本（查看/对比/回滚） | 查看/回滚 ✅ | 查看/回滚（限授权课程） ✅ | 仅查看 ✅ |
 | 用户管理（创建/删除/授课授权） | ✅ | ❌ | ❌ |
 | API Key 管理（创建/撤销/删除/统计） | ✅ | ❌ | ❌ |

 注：后端通过统一的权限检查实现“proofreader 只读”，在敏感写接口中拒绝其修改行为。

 ## 认证与请求头

 - JWT 认证（前端/人机交互）：
   - 登录：`POST /api/v1/auth/login` → `Authorization: Bearer <JWT>`
 - API Key 认证（脚本/集成）：二选一
   - `X-API-Key: <api-key>`
   - `Authorization: Bearer <api-key>`
 - 透传头（由后端中间件补齐，无需手动设置）：
   - `x-user-id`：默认使用配置中的用户 ID；若经认证，则以认证用户为准
   - `x-request-id`：若缺失自动生成，用于链路追踪
   - `x-admin-key`：仅部分需要管理员权限的上游操作会用到（由后端按需补齐）

 参考：`docs/guides/api-keys.md`、`docs/api/usage.md`

